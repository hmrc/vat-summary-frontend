@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import models.viewModels.PaymentsHistoryModel
@import views.html.templates.formatters.links.OpenInNewTab

@this(govukTable: GovukTable,
      paymentsHistoryCharge: PaymentsHistoryCharge,
        openInNewTab: OpenInNewTab)

@(years: Seq[Int],
  transactions: Seq[PaymentsHistoryModel],
  showPreviousPaymentsTab: Boolean
  )(implicit messages: Messages, appConfig: AppConfig, user: User)

@for(year <- years) {
  <div id="year-@year" class="govuk-tabs__panel@if(year != years.head) { govuk-tabs__panel--hidden}">
    <h2 class="govuk-heading-m">@year</h2>
    @if(transactions.exists(_.clearedDate.getOrElse("").toString.contains(year.toString))) {
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header govuk-visually-hidden" scope="col">
            @messages("paymentsHistory.paymentReceivedTitle")
          </th>

          <th class="govuk-table__header govuk-visually-hidden" scope="col">
            @messages("paymentsHistory.descriptionTitle")
          </th>

          <th class="numeric govuk-table__header govuk-visually-hidden" scope="col">
            @messages("paymentsHistory.amountTitle")
          </th>
        </tr>
      </thead>

      <tbody class="govuk-table__body">
        @for(transaction <- transactions.filter(_.clearedDate.getOrElse("").toString.contains(year.toString))) {
          @paymentsHistoryCharge(transaction)
        }
      </tbody>
    </table>

    } else {
      <p class="govuk-body">@messages("paymentsHistory.noCurrentYearHistory")</p>
    }
    </div>
}

@if(showPreviousPaymentsTab) {
  <div id="previous-payments" class="govuk-tabs__panel">
    <h2 class="govuk-heading-m">@messages("paymentsHistory.previousPayments.heading")</h2>
    <p class="govuk-body">
      @messages("paymentsHistory.previousPayments.youCan")
      @openInNewTab(
        link = appConfig.portalNonHybridPreviousPaymentsUrl(user.vrn),
        linkText = messages("paymentsHistory.previousPayments.viewPreviousPayments")
      )
      @messages("paymentsHistory.previousPayments.beforeMtd")
    </p>
  </div>
}

<noscript>
  <div>
    <a href="#top" class="govuk-link">
      <svg class="arrow input--radio-inline" width="13" height="15" viewBox="0 -5 13 15">
        <path fill="currentColor" d="M6.5 0L0 6.5 1.4 8l4-4v12.7h2V4l4.3 4L13 6.4z"></path>
      </svg><span>@messages("paymentsHistory.backToTop")</span>
    </a>
  </div>
</noscript>
